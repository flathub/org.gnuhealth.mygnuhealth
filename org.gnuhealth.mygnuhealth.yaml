id: org.gnuhealth.mygnuhealth
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
command: mygnuhealth

finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --share=network
  - --device=all # input & dri
  - --filesystem=xdg-documents

cleanup:
  - /include   # mtdev.h and X11 headers
  - /share/kivy-examples   # kivy-examples
  - /share/man   # xclip man files
  - /share/doc   # libXmu docs

modules:
  # 'bcrypt' is a direct dependency of mygnuhealth
  # The bcrypt Python library is handled specially since it has Rust code and dependencies.
  # The cryptography Python library is handled specially since it has Rust code and dependencies.
  - name: python3-bcrypt
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "bcrypt" --no-build-isolation
    sources:
      # x86_64 specific
      - type: file
        only-arches:
          - x86_64
        url: https://files.pythonhosted.org/packages/97/00/21e34b365b895e6faf9cc5d4e7b97dd419e08f8a7df119792ec206b4a3fa/bcrypt-4.1.3-cp39-abi3-manylinux_2_28_x86_64.whl
        sha256: 5f7cd3399fbc4ec290378b541b0cf3d4398e4737a65d0f938c7c0f9d5e686611
        x-checker-data:
          name: bcrypt
          packagetype: bdist_wheel
          type: pypi
      # aarch64 specific
      - type: file
        only-arches:
          - aarch64
        url: https://files.pythonhosted.org/packages/29/3c/6e478265f68eff764571676c0773086d15378fdf5347ddf53e5025c8b956/bcrypt-4.1.3-cp39-abi3-manylinux_2_28_aarch64.whl
        sha256: 3a5be252fef513363fe281bafc596c31b552cf81d04c5085bc5dac29670faa08
        x-checker-data:
          name: bcrypt
          packagetype: bdist_wheel
          type: pypi

  # 'requests' is a direct dependency of mygnuhealth
  # Generated with flatpak-pip-generator --runtime org.freedesktop.Sdk//24.08 --yaml --checker-data pip requests
  - name: python3-requests
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "requests" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/e5/48/1549795ba7742c948d2ad169c1c8cdbae65bc450d6cd753d124b17c8cd32/certifi-2025.8.3-py3-none-any.whl
        sha256: f6c12493cfb1b06ba2ff328595af9350c65d6644968e5d3a2ffd78699af217a5
        x-checker-data:
          name: certifi
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/83/2d/5fd176ceb9b2fc619e63405525573493ca23441330fcdaee6bef9460e924/charset_normalizer-3.4.3.tar.gz
        sha256: 6fce4b8500244f6fcb71465d4a4930d132ba9ab8e71a7859e6a5d59851068d14
        x-checker-data:
          name: charset-normalizer
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/76/c6/c88e154df9c4e1a2a66ccf0005a88dfb2650c1dffb6f5ce603dfbd452ce3/idna-3.10-py3-none-any.whl
        sha256: 946d195a0d259cbba61165e88e65941f16e9b36ea6ddb97f00452bae8b1287d3
        x-checker-data:
          name: idna
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/1e/db/4254e3eabe8020b458f1a747140d32277ec7a271daf1d235b70dc0b4e6e3/requests-2.32.5-py3-none-any.whl
        sha256: 2462f94637a34fd532264295e186976db0f5d453d1cdd31473c85a6a161affb6
        x-checker-data:
          name: requests
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/a7/c2/fe1e52489ae3122415c51f387e221dd0773709bad6c6cdaa599e8a2c5185/urllib3-2.5.0-py3-none-any.whl
        sha256: e6b01673c0fa6a13e374b50871808eb3bf7046c4b125b216f6bf1cc604cff0dc
        x-checker-data:
          name: urllib3
          packagetype: bdist_wheel
          type: pypi

  # 'pygal' is a direct dependency of mygnuhealth
  # Generated with flatpak-pip-generator --runtime org.freedesktop.Sdk//24.08 --yaml --checker-data pip pygal
  - name: python3-pygal
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pygal" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/20/b0/36bd937216ec521246249be3bf9855081de4c5e06a0c9b4219dbeda50373/importlib_metadata-8.7.0-py3-none-any.whl
        sha256: e5dd1551894c77868a30651cef00984d50e1002d06942a7101d34870c5f02afd
        x-checker-data:
          name: importlib_metadata
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/22/7d/b5d656dbeb73f488ce7409a75108a775f6cf8e20624ed8025a9476cbc1bb/pygal-3.0.5-py3-none-any.whl
        sha256: a3268a5667b470c8fbbb0eca7e987561a7321caeba589d40e4c1bc16dbe71393
        x-checker-data:
          name: pygal
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/2e/54/647ade08bf0db230bfea292f893923872fd20be6ac6f53b2b936ba839d75/zipp-3.23.0-py3-none-any.whl
        sha256: 071652d6115ed432f5ce1d34c336c0adfd6a884660d1e9712a256d3d3bd4b14e
        x-checker-data:
          name: zipp
          packagetype: bdist_wheel
          type: pypi
  # 'tinydb' is a direct dependency of mygnuhealth
  # Generated with flatpak-pip-generator --runtime org.freedesktop.Sdk//23.08 --yaml --checker-data pip tinydb
  - name: python3-tinydb
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "tinydb" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/78/17/853354204e1ca022d6b7d011ca7f3206c4f8faa3cc743e92609b49c1d83f/tinydb-4.8.2-py3-none-any.whl
        sha256: f97030ee5cbc91eeadd1d7af07ab0e48ceb04aa63d4a983adbaca4cba16e86c3
        x-checker-data:
          name: tinydb
          packagetype: bdist_wheel
          type: pypi
  # 'kivy' is a direct dependency of mygnuhealth and 'packaging' is a dependency of 'kivy'
  # Generated with flatpak-pip-generator --runtime org.freedesktop.Sdk//24.08 --yaml --checker-data pip packaging kivy
  - name: python3-packaging
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "packaging" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/20/12/38679034af332785aac8774540895e234f4d07f7545804097de4b666afd8/packaging-25.0-py3-none-any.whl
        sha256: 29572ef2b1f17581046b3a2227d5c611fb25ec70ca1ba8554b24b0e69331a484
        x-checker-data:
          name: packaging
          packagetype: bdist_wheel
          type: pypi
  # 'kivy' is a direct dependency of mygnuhealth and 'SDL' is a dependency of 'kivy'
  - ./SDL/libxmp.json
  - ./SDL/FluidSynth.json
  - ./SDL/SDL2.json
  - ./SDL/SDL2_image.json
  - ./SDL/SDL2_ttf.json
  - ./SDL/SDL2_mixer.json
  - name: python3-kivy
    buildsystem: simple
    build-commands:
      # Since cython can't be downgraded from the freedesktop SDK, we need to apply a fix on Kivy,
      # that works post Cython 3.1.0 (see https://github.com/cython/cython/issues/6857)
      - tar -xzvf Kivy-2.3.1.tar.gz && rm Kivy-2.3.1.tar.gz
      - patch -p0 < fix-build-for-cython-3.1.0.patch
      - tar -czvf Kivy-2.3.1.tar.gz Kivy-2.3.1
      - rm -rf Kivy-2.3.1
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "kivy" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/de/48/c40f023dc103bdbd56db11facbb2d0ecbf4b019f7392875ee2a8227cb51e/Kivy-2.3.1.tar.gz
        sha256: 0833949e3502cdb4abcf9c1da4384674045ad7d85644313aa1ee7573f3b4f9d9
        x-checker-data:
          name: Kivy
          type: pypi
      - type: file
        path: ./fix-build-for-cython-3.1.0.patch
      - type: file
        url: https://files.pythonhosted.org/packages/6a/55/cd1555bde62f809219cbc5d8a0836b0293399da2f4ba4e8ee84b6a7cc393/Kivy_Garden-0.1.5-py3-none-any.whl
        sha256: ef50f44b96358cf10ac5665f27a4751bb34ef54051c54b93af891f80afe42929
        x-checker-data:
          name: Kivy_Garden
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/e5/48/1549795ba7742c948d2ad169c1c8cdbae65bc450d6cd753d124b17c8cd32/certifi-2025.8.3-py3-none-any.whl
        sha256: f6c12493cfb1b06ba2ff328595af9350c65d6644968e5d3a2ffd78699af217a5
        x-checker-data:
          name: certifi
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/83/2d/5fd176ceb9b2fc619e63405525573493ca23441330fcdaee6bef9460e924/charset_normalizer-3.4.3.tar.gz
        sha256: 6fce4b8500244f6fcb71465d4a4930d132ba9ab8e71a7859e6a5d59851068d14
        x-checker-data:
          name: charset_normalizer
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/44/57/8db39bc5f98f042e0153b1de9fb88e1a409a33cda4dd7f723c2ed71e01f6/docutils-0.22-py3-none-any.whl
        sha256: 4ed966a0e96a0477d852f7af31bdcb3adc049fbb35ccba358c2ea8a03287615e
        x-checker-data:
          name: docutils
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/18/79/1b8fa1bb3568781e84c9200f951c735f3f157429f44be0495da55894d620/filetype-1.2.0-py2.py3-none-any.whl
        sha256: 7ce71b6880181241cf7ac8697a2f1eb6a8bd9b429f7ad6d27b8db9ba5f1c2d25
        x-checker-data:
          name: filetype
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/76/c6/c88e154df9c4e1a2a66ccf0005a88dfb2650c1dffb6f5ce603dfbd452ce3/idna-3.10-py3-none-any.whl
        sha256: 946d195a0d259cbba61165e88e65941f16e9b36ea6ddb97f00452bae8b1287d3
        x-checker-data:
          name: idna
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/1e/db/4254e3eabe8020b458f1a747140d32277ec7a271daf1d235b70dc0b4e6e3/requests-2.32.5-py3-none-any.whl
        sha256: 2462f94637a34fd532264295e186976db0f5d453d1cdd31473c85a6a161affb6
        x-checker-data:
          name: requests
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/a7/c2/fe1e52489ae3122415c51f387e221dd0773709bad6c6cdaa599e8a2c5185/urllib3-2.5.0-py3-none-any.whl
        sha256: e6b01673c0fa6a13e374b50871808eb3bf7046c4b125b216f6bf1cc604cff0dc
        x-checker-data:
          name: urllib3
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/c7/21/705964c7812476f378728bdf590ca4b771ec72385c533964653c68e86bdc/pygments-2.19.2-py3-none-any.whl
        sha256: 86540386c03d588bb81d44bc3928634ff26449851e99741617ecb9037ee5ec0b
        x-checker-data:
          name: Pygments
          packagetype: bdist_wheel
          type: pypi
    # 'python-dateutil' is a direct dependency of mygnuhealth
    # Generated with flatpak-pip-generator --runtime org.freedesktop.Sdk//23.08 --yaml --checker-data pip python-dateutil
  - name: python3-python-dateutil
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "python-dateutil" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/b7/ce/149a00dd41f10bc29e5921b496af8b574d8413afcd5e30dfa0ed46c2cc5e/six-1.17.0-py2.py3-none-any.whl
        sha256: 4721f391ed90541fddacab5acf947aa0d3dc7d27b2e1e8eda2be8970586c3274
        x-checker-data:
          name: six
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/ec/57/56b9bcc3c9c6a792fcbaf139543cee77261f3651ca9da0c93f5c1221264b/python_dateutil-2.9.0.post0-py2.py3-none-any.whl
        sha256: a8b2bc7bffae282281c8140a97d3aa9c14da0b136dfe83f850eea9a5f7470427
        x-checker-data:
          name: python-dateutil
          packagetype: bdist_wheel
          type: pypi
    # 'bleak' is a direct dependency of mygnuhealth
    # Generated with flatpak-pip-generator --runtime org.freedesktop.Sdk//24.08 --yaml --checker-data pip python-dateutil
  - name: python3-bleak
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "bleak" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/18/67/36e9267722cc04a6b9f15c7f3441c2363321a3ea07da7ae0c0707beb2a9c/typing_extensions-4.15.0-py3-none-any.whl
        sha256: f0fa19c6845758ab08074a0cfa8b7aecb71c999ca73d62883bc25cc018c4e548
        x-checker-data:
          name: typing-extensions
          packagetype: bdist_wheel
          type: pypi
      # x86_64 specific
      - type: file
        only-arches:
          - x86_64
        url: https://files.pythonhosted.org/packages/78/c8/b45ff0a015f606c1998df2070967f016f873d4087845af14fd3d01303b0b/dbus_fast-2.44.3-cp313-cp313-manylinux_2_36_x86_64.whl
        sha256: 6e0a6a27a1f53b32259d0789bca6f53decd88dec52722cac9a93327f8b7670c3
        x-checker-data:
          name: dbus-fast
          packagetype: bdist_wheel
          type: pypi
      # aarch64 specific
      - type: file
        only-arches:
          - aarch64
        url: https://files.pythonhosted.org/packages/ca/cf/e4ae27e14e470b84827848694836e8fae0c386162d98e43f891783c0abc8/dbus_fast-2.44.3-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl
        sha256: da0910f813350b951efe4964a19d7f4aaf253b6c1021b0d68340160a990dc2fc
        x-checker-data:
          name: dbus-fast
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/81/5a/c3378ba7b05abc7c2d95ae492eac0523d937c77afcb9ff7e7f67fe2ca11d/bleak-1.1.1-py3-none-any.whl
        sha256: e601371396e357d95ee3c256db65b7da624c94ef6f051d47dfce93ea8361c22e
        x-checker-data:
          name: bleak
          packagetype: bdist_wheel
          type: pypi
    # 'cairosvg' is a direct dependency of mygnuhealth
    # Generated with flatpak-pip-generator --runtime org.freedesktop.Sdk//23.08 --yaml --checker-data pip cairosvg
  - name: python3-cairosvg
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "cairosvg" "olefile" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/67/48/816bd4aaae93dbf9e408c58598bc32f4a8c65f4b86ab560864cb3ee60adb/cairosvg-2.8.2-py3-none-any.whl
        sha256: eab46dad4674f33267a671dce39b64be245911c901c70d65d2b7b0821e852bf5
        x-checker-data:
          name: CairoSVG
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/93/d8/ba13451aa6b745c49536e87b6bf8f629b950e84bd0e8308f7dc6883b67e2/cairocffi-1.7.1-py3-none-any.whl
        sha256: 9803a0e11f6c962f3b0ae2ec8ba6ae45e957a146a004697a1ac1bbf16b073b3f
        x-checker-data:
          name: cairocffi
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/eb/56/b1ba7935a17738ae8453301356628e8147c79dbb825bcbc73dc7401f9846/cffi-2.0.0.tar.gz
        sha256: 44d1b5909021139fe36001ae048dbdde8214afa20200eda0f64c068cac5d5529
        x-checker-data:
          name: cffi
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/0f/e7/aa315e6a749d9b96c2504a1ba0ba031ba2d0517e972ce22682e3fccecb09/cssselect2-0.8.0-py3-none-any.whl
        sha256: 46fc70ebc41ced7a32cd42d58b1884d72ade23d21e5a4eaaf022401c13f0e76e
        x-checker-data:
          name: cssselect2
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/07/6c/aa3f2f849e01cb6a001cd8554a88d4c77c5c1a31c95bdf1cf9301e6d9ef4/defusedxml-0.7.1-py2.py3-none-any.whl
        sha256: a352e7e428770286cc899e2542b6cdaedb2b4953ff269a210103ec58f6198a61
        x-checker-data:
          name: defusedxml
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/69/1b/077b508e3e500e1629d366249c3ccb32f95e50258b231705c09e3c7a4366/olefile-0.47.zip
        sha256: 599383381a0bf3dfbd932ca0ca6515acd174ed48870cbf7fee123d698c192c1c
        x-checker-data:
          name: olefile
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/f3/0d/d0d6dea55cd152ce3d6767bb38a8fc10e33796ba4ba210cbab9354b6d238/pillow-11.3.0.tar.gz
        sha256: 3828ee7586cd0b2091b6209e5ad53e20d0649bbe87164a459d0676e035e8f523
        x-checker-data:
          name: pillow
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/a0/e3/59cd50310fc9b59512193629e1984c1f95e5c8ae6e5d8c69532ccc65a7fe/pycparser-2.23-py3-none-any.whl
        sha256: e5c6e8d3fbad53479cab09ac03729e0a9faf2bee3db8208a550daf5af81a5934
        x-checker-data:
          name: pycparser
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/e6/34/ebdc18bae6aa14fbee1a08b63c015c72b64868ff7dae68808ab500c492e2/tinycss2-1.4.0-py3-none-any.whl
        sha256: 3a49cf47b7675da0b15d0c6e1df8df4ebd96e9394bb905a5775adb0d884c5289
        x-checker-data:
          name: tinycss2
          packagetype: bdist_wheel
          type: pypi
      - type: file
        url: https://files.pythonhosted.org/packages/f4/24/2a3e3df732393fed8b3ebf2ec078f05546de641fe1b667ee316ec1dcf3b7/webencodings-0.5.1-py2.py3-none-any.whl
        sha256: a0af1213f3c2226497a97e2b3aa01a7e4bee4f403f95be16fc9acd2947514a78
        x-checker-data:
          name: webencodings
          packagetype: bdist_wheel
          type: pypi
  # 'tinycss' is a direct dependency of mygnuhealth
  # Generated with flatpak-pip-generator --runtime org.freedesktop.Sdk//23.08 --yaml --checker-data pip tinycss
  - name: python3-tinycss
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "tinycss" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/05/59/af583fff6236c7d2f94f8175c40ce501dcefb8d1b42e4bb7a2622dff689e/tinycss-0.4.tar.gz
        sha256: 12306fb50e5e9e7eaeef84b802ed877488ba80e35c672867f548c0924a76716e
        x-checker-data:
          name: tinycss
          type: pypi

  # Generated with flatpak-pip-generator --runtime org.freedesktop.Sdk//23.08 --yaml --checker-data pip cssselect
  - name: python3-cssselect
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "cssselect" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/ee/58/257350f7db99b4ae12b614a36256d9cc870d71d9e451e79c2dc3b23d7c3c/cssselect-1.3.0-py3-none-any.whl
        sha256: 56d1bf3e198080cc1667e137bc51de9cadfca259f03c2d4e09037b3e01e30f0d
        x-checker-data:
          name: cssselect
          packagetype: bdist_wheel
          type: pypi
  # Runtime dependencies of Kivy
  - name: libXmu
    buildsystem: autotools
    sources:
      - type: archive
        url: https://gitlab.freedesktop.org/xorg/lib/libxmu/-/archive/libXmu-1.2.1/libxmu-libXmu-1.2.1.tar.gz
        sha256: 420979c1fd4438a9f41e0086f10c8d2a00125643f6d4ff7ed67282878ae39531
        x-checker-data:
          type: anitya
          project-id: 1785
          stable-only: true
          url-template: https://gitlab.freedesktop.org/xorg/lib/libxmu/-/archive/libXmu-$version/libxmu-libXmu-$version.tar.gz

  - name: xclip
    buildsystem: autotools
    sources:
      - type: archive
        url: https://github.com/astrand/xclip/archive/0.13.tar.gz
        sha256: ca5b8804e3c910a66423a882d79bf3c9450b875ac8528791fb60ec9de667f758
        x-checker-data:
          type: anitya
          project-id: 14150
          stable-only: true
          url-template: https://github.com/astrand/xclip/archive/$version.tar.gz

  - name: mtdev
    buildsystem: autotools
    sources:
      - type: archive
        url: http://bitmath.org/code/mtdev/mtdev-1.1.7.tar.gz
        sha256: a55bd02a9af4dd266c0042ec608744fff3a017577614c057da09f1f4566ea32c
        x-checker-data:
          type: anitya
          project-id: 8868
          stable-only: true
          url-template: http://bitmath.org/code/mtdev/mtdev-$version.tar.gz
      - type: shell
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} config-aux
  - name: mygnuhealth
    buildsystem: simple
    build-commands:
      - install -Dm644 org.gnuhealth.mygnuhealth.desktop ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
      - desktop-file-edit --set-key="Icon" --set-value="${FLATPAK_ID}" ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
      - install -Dm644 org.gnuhealth.mygnuhealth.metainfo.xml ${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.appdata.xml
      - for s in {32,64,128}; do ffmpeg -i mygnuhealth/images/mygnuhealth-icon.png
        -s "${s}x${s}" -update true "mygnuhealth/images/mygnuhealth-icon_${s}x${s}.png";
        install -Dm644 "mygnuhealth/images/mygnuhealth-icon_${s}x${s}.png" "${FLATPAK_DEST}/share/icons/hicolor/${s}x${s}/apps/${FLATPAK_ID}.png";
        done;
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "." --no-build-isolation
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/5e/24/383a86b5c03afbf288e2548186b7be51ae81fa377fc34dc16f86fddf5b4d/mygnuhealth-2.2.1.tar.gz
        sha256: 69027a34c3a4659928b9d617bdb007de6cec9eced768d524c9a854061f496869
        x-checker-data:
          type: pypi
          name: mygnuhealth
